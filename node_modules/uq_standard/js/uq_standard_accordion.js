/**
 * @file
 * UQ Accordion JS.
 */
(function ($, window, undefined) {
  var accordion, accordionToggle, accordionToggleActive, accordionContent;

  $(document).ready(function () {
    var hash = 0;
    var thash = 0;
    accordion = $('.accordion');
    accordionToggle = $('.accordion__toggle');
    accordionToggleActive = $('.accordion__toggle--active');
    accordionContent = $('.accordion__content');

    if (window.location.hash) {
      hash = window.location.hash;
      thash = hash.replace('#', '');
    }

    accordion.find('a[name=' + thash + ']').closest(accordionToggle).next().slideToggle('fast');
    // Only apply classes on load when linking directly to an accordion item.
    if (window.location.hash !== '') {
      accordion.find('a[name=' + thash + ']').closest(accordionToggle).addClass('accordion__toggle--active');
      accordion.find('a[name=' + thash + ']').closest(accordionToggle).next().addClass('accordion__content--active');
    }

    // Quicktabs uses inline styles to display:block the first accordion content. We strip this on first load to stop
    // the first accordion defaulting to open.
    accordion.find('div.default').removeAttr('style');
  });

  $(document).on('click', '.accordion__toggle', function () {
    // Expand or collapse this panel.
    $(this).next().slideToggle('fast');
    $(this).toggleClass('accordion__toggle--active');
    $(this).next().toggleClass('accordion__content--active');

    // Scroll to top of selected item.
    if (accordionToggleActive && accordionToggleActive.length) {
      $('html, body').animate({
        scrollTop: accordionToggleActive.offset().top
      }, 200);
    }

    // Hide the other panels.
    if (accordionContent && accordionToggle) {
      accordionContent.not($(this).next()).slideUp('fast');
      accordionToggle.not($(this)).removeClass('accordion__toggle--active');
      accordionContent.not($(this).next()).removeClass('accordion__content--active');
    }
  });
})(jQuery, window);
